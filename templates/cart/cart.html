{% extends 'base.html' %}
{% load static %}
{% block content %}
<body>
  <!--================Home Banner Area =================-->
  {% comment %} <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Cart Products</h2>
              <p>Home <span>-</span>Cart Products</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start--> {% endcomment %}

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
                <th scope="col">update</th>
              </tr>
            </thead>
            <tbody>
            {% for cart_item in cart_items %}

              <tr>
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <img src="{{cart_item.product.images.url}}" alt="" width="100" height="100">
 
                    </div>
                    <div class="media-body">
                      
                      <p>{{cart_item.product.product_name}}</p>
                    </div>
                  </div>
                </td>
                <td>
                  <h5>₹{{cart_item.product.price}}</h5>
                </td>
                <td>
                  <div class="product_count">
                    {% comment %} <a href= "{% url 'remove_cart' cart_item.product.id cart_item.id  %}"class="input-number-decrement"> <i class="ti-angle-down"></i></a> {% endcomment %}
                    <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" class="input-number-decrement" data-product-id="{{cart_item.product.id}}" data-cart-item-id="{{cart_item.id}}"> <i class="ti-angle-down"></i></a>
                    {% comment %} <input class="input-number" type="text" value="{{cart_item.quantity}}" min="0" max="10"> {% endcomment %}
                    <input class="input-number cart-quantity" type="text" value="{{cart_item.quantity}}" min="0" max="10">

                    {% comment %} <a href = "{% url 'add_cart' cart_item.product.id %}" class="input-number-increment" type="button" id="button-plus"> <i class="ti-angle-up"></i></a> {% endcomment %}
                    <a href="{% url 'add_cart' cart_item.product.id %}" class="input-number-increment" data-product-id="{{cart_item.product.id}}"> <i class="ti-angle-up"></i></a>

                   
                  </div>
                  
                </td>
                <td>
                  <h5>₹{{cart_item.sub_total}}</h5>
                </td>
                <td class="text-right">
                  <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" class="btn btn-danger"> Remove</a>
                </td>
              </tr>
            
            {% endfor %}    
                
              
              
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5><br>
                  <h5>tax</h5><br>
                  <h5>grand total</h5><br>
                </td>
                <td>
                  <h5>₹{{total}}</h5><br>
                  <h5>₹{{tax}}</h5><br>
                  <h5>₹{{grand_total}}</h5><br>
                </td>
                <br>
                
                
                
              </tr>
              {% comment %} <tr class="shipping_area">
                <td></td>
                <td></td>
                <td>
                  <h5>Shipping</h5>
                </td>
                <td>
                  <div class="shipping_box">
                    <ul class="list">
                      <li>
                        <a href="#">Flat Rate: $5.00</a>
                      </li>
                      <li>
                        <a href="#">Free Shipping</a>
                      </li>
                      <li>
                        <a href="#">Flat Rate: $10.00</a>
                      </li>
                      <li class="active">
                        <a href="#">Local Delivery: $2.00</a>
                      </li>
                    </ul>
                    <h6>
                      Calculate Shipping
                      <i class="fa fa-caret-down" aria-hidden="true"></i>
                    </h6>
                    <select class="shipping_select">
                      <option value="1">Bangladesh</option>
                      <option value="2">India</option>
                      <option value="4">Pakistan</option>
                    </select>
                    <select class="shipping_select section_bg">
                      <option value="1">Select a State</option>
                      <option value="2">Select a State</option>
                      <option value="4">Select a State</option>
                    </select>
                    <input type="text" placeholder="Postcode/Zipcode" />
                    <a class="btn_1" href="#">Update Details</a>
                  </div>
                </td> {% endcomment %}
              {% comment %} </tr> {% endcomment %}
            </tbody>
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1" href="{% url 'store' %}">Continue Shopping</a>
            <a class="btn_1 checkout_btn_1" href="{% url 'checkout' %}">Proceed to checkout</a>
          </div>
        </div>
      </div>
  </section>
  <!--================End Cart Area =================-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('.input-number-increment, .input-number-decrement').click(function(e) {
        e.preventDefault();
        var product_id = $(this).data('product-id');
        var cart_item_id = $(this).data('cart-item-id');
        var quantity = parseInt($('.cart-quantity[data-product-id="' + product_id + '"][data-cart-item-id="' + cart_item_id + '"]').val());
    
        // Increment or decrement the quantity
        if ($(this).hasClass('input-number-increment')) {
          quantity++;
        } else {
          quantity--;
        }
    
        // Make the AJAX request to update the cart quantity
        $.ajax({
          url: '{% url "update_cart" %}',
          type: 'POST',
          data: {
            product_id: product_id,
            cart_item_id: cart_item_id,
            quantity: quantity,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          },
          success: function(data) {
            // Update the quantity on the page
            $('.cart-quantity[data-product-id="' + product_id + '"][data-cart-item-id="' + cart_item_id + '"]').val(quantity);
          }
        });
      });
    });
    </script>
</body>
{% endblock %}
</html>
